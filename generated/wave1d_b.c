/*        Generated by TAPENADE     (INRIA, Ecuador team)
    Tapenade 3.14 (r7079) -  5 Oct 2018 09:55
*/
#include <adBuffer.h>

/*
  Differentiation of wave1d in reverse (adjoint) mode:
   gradient     of useful results: *u *u_1 *u_2
   with respect to varying inputs: *u *u_1 *u_2
   RW status of diff variables: *u:in-out *u_1:incr *u_2:incr
   Plus diff mem management of: u:in u_1:in u_2:in
*/
void wave1d_b(double *u, double *ub, double *u_1, double *u_1b, double *u_2, 
        double *u_2b, double *c, double D, int n) {
    int i;
    double tempb;
#pragma omp parallel for private(tempb)
    for (i = n-2; i > 0; --i) {
        tempb = D*c[i]*ub[i];
	#pragma omp atomic
        u_1b[i - 1] = u_1b[i - 1] + tempb;
	#pragma omp atomic
        u_1b[i] = u_1b[i] + 2.0*ub[i] - 2*tempb;
	#pragma omp atomic
        u_1b[i + 1] = u_1b[i + 1] + tempb;
        u_2b[i] = u_2b[i] - ub[i];
    }
}
